# Style Guide Migration Guide

**Version**: 3.0.0
**Date**: 2025-11-07
**Migration**: From 3-phase design workflow to comprehensive style guide approach

## Executive Summary

The Spec-Flow workflow has replaced the multi-phase design system (variations → functional → polish) with a **comprehensive style guide SST** approach. This change delivers:

- **75-85% faster** UI development (<30 min vs 2-4 hours per feature)
- **82-88% fewer tokens** (10-15K vs 85K per screen)
- **Zero manual design gates** (automated validation)
- **Single source of truth** (style-guide.md)

**No breaking changes** - the old workflow is archived and the new approach is backward compatible.

---

## Table of Contents

1. [Why We Changed](#why-we-changed)
2. [What Was Replaced](#what-was-replaced)
3. [What's New](#whats-new)
4. [Migration Steps](#migration-steps)
5. [Before/After Examples](#beforeafter-examples)
6. [Troubleshooting](#troubleshooting)
7. [FAQ](#faq)

---

## Why We Changed

### Problems with 3-Phase Design Workflow

**1. Too Slow**
- 30-75 minutes per screen across 3 phases
- 2-4 hours total for typical features
- Manual human gates slowed iteration

**2. High Token Cost**
- Phase 1 (Variations): ~50K tokens (generate 3-5 variants)
- Phase 2 (Functional): ~15K tokens (merge + a11y)
- Phase 3 (Polish): ~20K tokens (apply brand tokens)
- **Total**: 85K tokens per screen

**3. Manual Bottlenecks**
- Human must critique variants (fill crit.md)
- Manual approval gates between phases
- Design decisions made ad-hoc, not systematically

**4. Low ROI on Variants**
- Generated 3-5 variants per screen
- User selects 1 variant
- **80% of work discarded**

**5. Complexity**
- 5 design commands (4,675 lines total)
- Multiple intermediate artifacts
- Context scattered across files

### Benefits of Style Guide Approach

**1. Speed**
- Single phase implementation (<30 min)
- No manual critique gates
- Automated validation

**2. Token Efficiency**
- Read style guide once (~5K tokens)
- Generate single polished component (~10K tokens)
- **Total**: 15K tokens per screen (82% reduction)

**3. Consistency**
- Rules documented in style-guide.md
- Automated enforcement
- No manual design decisions

**4. Simplicity**
- 1,500-line style guide SST
- Single command (`/quick`)
- Direct implementation

---

## What Was Replaced

### Archived Commands

All moved to `.claude/commands/archive/` with deprecation notices:

1. **`/design`** - Orchestrator for 3-phase workflow
2. **`/design-variations`** - Phase 1: Generate 3-5 grayscale variants
3. **`/design-functional`** - Phase 2: Merge variants, add a11y
4. **`/design-polish`** - Phase 3: Apply brand tokens, optimize
5. **`/research-design`** - Gather design inspiration

**Total removed**: 4,675 lines of command code

### Archived Files

Moved to `.spec-flow/memory/archive/`:

- `design-principles.md` (413 lines) → Replaced by style guide Foundation section
- `design-inspirations.md` (137 lines) → Replaced by style guide Patterns section

**Content migrated** to `docs/project/style-guide.md`

### Removed Artifacts

No longer generated:

- `/mock/$SLUG/$SCREEN/v1-v5/` - Individual variants
- `design/$SLUG/crit.md` - Manual critique file
- `design/$SLUG/implementation-spec.md` - Phase 3 output
- Variant comparison pages
- Variant notes files

---

## What's New

### 1. Comprehensive Style Guide

**Location**: `docs/project/style-guide.md`

**Generated by**: `/init-project` (customized per project)

**8 Core Sections**:

1. **Foundation** - Philosophy, core 9 rules, token system overview
2. **Colors** - OKLCH system, semantic tokens, context-aware mapping
3. **Typography** - Hierarchy, letter-spacing, line length
4. **Spacing & Layout** - 8pt grid, layout ratios, breakpoints
5. **Visual Elements** - Shadows, gradients, motion, focus states
6. **Components** - Lightweight guidelines for buttons, forms, cards, etc.
7. **Patterns** - Common UI patterns, accessibility, responsive behavior
8. **Implementation** - Tailwind integration, validation rules, testing

**Size**: ~1,500 lines (comprehensive but focused)

### 2. Core 9 Rules (Always Enforced)

User-defined foundational rules documented in style guide:

1. **Break up text**: 50-75 chars (600-700px max-width)
2. **Bullet points with icons**: Designer's best friend
3. **8pt grid spacing**: All values divisible by 4/8
4. **Layout rules**: Baseline value, double spacing, 2:1 line heights
5. **Letter-spacing**: Display -1px, Body 0px, CTAs +1px
6. **Font superfamilies**: Matching character sizes
7. **OKLCH colors**: Never hex (perceptually uniform)
8. **Subtle design**: Gradients <20% opacity, soft shadows
9. **Squint test**: CTAs/headlines stand out when blurred

### 3. Automated Validation

**Checks run on every UI change**:

```bash
/quick "Add dashboard"
# Auto-validates:
# ✅ No hardcoded colors (hex, rgb, hsl)
# ✅ Spacing on 8pt grid
# ✅ Typography hierarchy (2:1 ratios)
# ✅ Focus states present
# ✅ Text line length 50-75 chars
```

**Non-blocking warnings** - guide improvements without stopping flow

### 4. Updated Commands

**`/init-project`** (updated)
- Now generates **11 docs** (added style-guide.md)
- Pre-populated with project context
- Core 9 rules included by default

**`/quick`** (enhanced)
- Auto-detects UI changes
- Loads style-guide.md, tokens.json, ui-inventory.md
- Enforces core 9 rules
- Runs automated validation
- Displays warnings (non-blocking)

---

## Migration Steps

### For Existing Projects

**Step 1: Generate style guide**

```bash
# Option A: Run init-project (regenerate all docs)
/init-project

# Choose option 2 to regenerate, or option 3 to update just style-guide.md
```

**Step 2: Review and customize**

```bash
# Open style guide
open docs/project/style-guide.md

# Fill any [NEEDS CLARIFICATION] sections
# Customize colors, typography, spacing for your project
# Add project-specific component guidelines
```

**Step 3: Commit**

```bash
git add docs/project/style-guide.md
git commit -m "docs: add comprehensive style guide (v3.0.0 migration)"
```

**Step 4: Test with UI change**

```bash
# Try creating a simple UI component
/quick "Add student card component"

# Should auto-load style guide and validate
# Check output for style guide adherence report
```

**Step 5: Archive old design artifacts (optional)**

```bash
# If you have old /mock/ directories from design phases
rm -rf apps/app/mock/

# If you have old design/ directories
rm -rf specs/*/design/
```

### For New Projects

**Automatic** - No migration needed:
- `/init-project` generates style-guide.md automatically
- Core 9 rules included by default
- UI changes automatically follow style guide

---

## Before/After Examples

### Example 1: Button Component

**Before** (3-phase workflow):

```bash
# Phase 1: Generate variants (25 min, 50K tokens)
/design-variations "Dashboard CTA buttons"
# Output: 5 grayscale button variants

# Phase 2: Merge (20 min, 15K tokens)
# Manually select variant 3 in crit.md
/design-functional "Dashboard CTA buttons"
# Output: Functional prototype with a11y

# Phase 3: Polish (25 min, 20K tokens)
/design-polish "Dashboard CTA buttons"
# Output: Brand tokens applied, production ready

# Total: 70 minutes, 85K tokens
```

**After** (style guide):

```bash
# Single command (10 min, 15K tokens)
/quick "Add dashboard CTA buttons"
# Auto-loads style-guide.md
# Enforces core 9 rules
# Generates production-ready component
# Validates automatically

# Total: 10 minutes, 15K tokens
```

**Savings**: 86% faster, 82% fewer tokens

---

### Example 2: Form Layout

**Before** (3-phase workflow):

```bash
/design-variations "User profile form"
# 5 variants: minimal, standard, detailed, compact, split
# User selects "standard"

/design-functional "User profile form"
# Adds inline validation (Stripe-style)
# Adds keyboard nav
# Creates Playwright tests

/design-polish "User profile form"
# Applies brand tokens
# Adds subtle shadows
# Optimizes performance

# Total: 90 minutes for 3-4 form fields
```

**After** (style guide):

```bash
/quick "Add user profile form with inline validation"
# Reads style guide Section 6 (Forms)
# Uses shadcn/ui Input + Label components
# Applies core 9 rules:
#   - 8pt grid spacing
#   - Letter-spacing (Body 0px)
#   - Max width 600-700px
#   - Focus states with ring-2
# Generates with inline validation pattern from style guide

# Total: 15 minutes
```

**Savings**: 83% faster

---

### Example 3: Dashboard with Cards

**Before** (3-phase workflow):

```bash
# Phase 1: 5 layouts × 3 card variants = 15 variants
/design-variations "Student dashboard"
# Token cost: 50K × 3 screens = 150K tokens
# Time: 75 minutes

# Phase 2: Merge selected variants
/design-functional "Student dashboard"
# Token cost: 15K × 3 screens = 45K tokens
# Time: 45 minutes

# Phase 3: Brand polish
/design-polish "Student dashboard"
# Token cost: 20K × 3 screens = 60K tokens
# Time: 60 minutes

# Total: 180 minutes (3 hours), 255K tokens
```

**After** (style guide):

```bash
/quick "Add student dashboard with progress cards"
# Style guide Section 6 (Cards):
#   - shadow-md for elevation
#   - rounded-lg borders
#   - p-6 padding (24px on 8pt grid)
#   - Compose with shadcn/ui Card primitives
# Section 7 (Patterns):
#   - Bullet points with icons for features
#   - 8pt grid spacing between cards
#   - Responsive grid (1 col mobile, 2 col tablet, 3 col desktop)

# Total: 25 minutes, 25K tokens (3 simple cards)
```

**Savings**: 86% faster, 90% fewer tokens

---

## Troubleshooting

### Issue: Style guide not found

**Error**:
```
❌ Style guide not found: docs/project/style-guide.md
Run /init-project first to generate project documentation.
```

**Solution**:
```bash
# Generate project docs (includes style-guide.md)
/init-project

# Or manually copy template
cp .spec-flow/templates/style-guide.md docs/project/style-guide.md
# Then customize for your project
```

---

### Issue: UI changes not loading style guide

**Symptom**: `/quick` runs but doesn't show "UI CHANGE DETECTED" message

**Cause**: Description doesn't include UI-related keywords

**Solution**: Include UI-related terms in description:
```bash
# ✅ Correct (triggers style guide)
/quick "Add button component to dashboard"
/quick "Update form layout"
/quick "Style card with Tailwind"

# ❌ Won't trigger (no UI keywords)
/quick "Fix user service bug"
/quick "Add API endpoint"
```

**UI Keywords**: component, button, form, card, layout, design, style, CSS, Tailwind, color, spacing, font, typography

---

### Issue: Style guide validation warnings

**Warning**:
```
⚠️  Found 3 hardcoded color(s)
   Replace with design tokens from tokens.json
```

**Solution**:
```tsx
// ❌ Before (hardcoded)
<Button style={{ backgroundColor: '#3b82f6' }}>
  Click Me
</Button>

// ✅ After (design tokens)
<Button className="bg-brand-primary">
  Click Me
</Button>
```

---

### Issue: Arbitrary spacing warnings

**Warning**:
```
⚠️  Found 2 arbitrary spacing value(s)
   Use 8pt grid system (space-1, space-2, space-4, etc.)
```

**Solution**:
```tsx
// ❌ Before (arbitrary)
<div className="space-y-[23px] mt-[17px]">
  Content
</div>

// ✅ After (8pt grid)
<div className="space-y-6 mt-4">  {/* 24px, 16px */}
  Content
</div>
```

**8pt Grid Reference**:
- space-1: 4px (0.5 × 8)
- space-2: 8px (1 × 8)
- space-4: 16px (2 × 8)
- space-6: 24px (3 × 8)
- space-8: 32px (4 × 8)

---

### Issue: Missing focus states

**Warning**:
```
⚠️  Some interactive elements may be missing focus states
   Add focus:ring-2 focus:ring-brand-primary to buttons
```

**Solution**:
```tsx
// ❌ Before (no focus state)
<Button>Click Me</Button>

// ✅ After (with focus)
<Button className="focus:ring-2 focus:ring-brand-primary focus:ring-offset-2">
  Click Me
</Button>
```

---

### Issue: Want to customize style guide rules

**Question**: Can I modify the core 9 rules?

**Answer**: Yes! The style guide is customizable per project.

```bash
# Edit your project's style guide
open docs/project/style-guide.md

# Example customizations:
# - Change 8pt grid to 4pt grid
# - Adjust line length from 600-700px to 800-900px
# - Add project-specific component guidelines
# - Modify color token mapping rules

# Commit changes
git add docs/project/style-guide.md
git commit -m "docs: customize style guide for project needs"
```

**Best practice**: Document why you deviated from defaults (in commit message or style guide itself)

---

## FAQ

### Q: Can I still use the old 3-phase workflow?

**A**: The old commands are archived but still accessible. However, they're deprecated and won't receive updates.

To use archived commands:
```bash
# View archived command
cat .claude/commands/archive/design-deprecated-2025-11-07.md

# Not recommended - use style guide approach instead
```

---

### Q: Will my existing features break?

**A**: No. This change is backward compatible. Existing code continues to work. Only new UI development uses the style guide approach.

---

### Q: How do I update an old feature built with 3-phase workflow?

**A**: No immediate action required. When you need to modify the UI:

```bash
# Use /quick with style guide
/quick "Update dashboard card styling"
# New changes will follow style guide rules
# Old code can remain as-is
```

**Optional refactoring**:
```bash
# Audit old code for style guide compliance
grep -r "#[0-9a-fA-F]\{6\}" apps/  # Find hardcoded colors
grep -r "\[[0-9]\+px\]" apps/      # Find arbitrary spacing

# Refactor gradually during normal maintenance
```

---

### Q: What if I don't have design tokens yet?

**A**: The style guide works without tokens.json (uses Tailwind defaults).

```bash
# Create minimal tokens.json
mkdir -p design/systems
cat > design/systems/tokens.json <<'EOF'
{
  "colors": {
    "brand": {
      "primary": "oklch(0.55 0.22 250)"
    },
    "neutral": {
      "50": "oklch(0.98 0.00 0)",
      "900": "oklch(0.18 0.00 0)"
    }
  }
}
EOF
```

Or define colors inline in style-guide.md.

---

### Q: Can I still do design exploration/variants?

**A**: Yes, but differently:

**Old way** (generated 5 variants automatically):
```bash
/design-variations "Dashboard"
# Generated v1-v5 automatically
# Manual critique in crit.md
```

**New way** (iterate on single design):
```bash
# Generate first version
/quick "Add dashboard"

# Iterate based on feedback
/quick "Update dashboard - reduce card padding"
/quick "Update dashboard - change CTA color to accent"

# Faster iteration, same exploration, no wasted variants
```

---

### Q: How do I share style guide across multiple projects?

**A**: Two approaches:

**Approach 1: Fork template**
```bash
# Update workflow template
edit .spec-flow/templates/style-guide.md
# All new projects get updated template via /init-project
```

**Approach 2: Copy between projects**
```bash
# From project A
cp docs/project/style-guide.md ~/style-guide-base.md

# To project B
cp ~/style-guide-base.md docs/project/style-guide.md
# Customize for project B specifics
```

---

### Q: What about design handoffs from designers?

**A**: Style guide complements design handoffs:

1. **Designer creates mockups** (Figma, Sketch, etc.)
2. **Engineer documents patterns in style guide**:
   - Extract colors → tokens.json
   - Measure spacing → verify 8pt grid
   - Document components → style guide Section 6
3. **Implementation follows style guide** (not Figma pixel-by-pixel)

**Benefit**: Design system documented in code, not just design tools

---

### Q: How do I validate an entire project for style guide compliance?

**A**: Run automated validation:

```bash
# Check all files for hardcoded colors
grep -rE "#[0-9a-fA-F]{3,6}|rgb\(|hsl\(" apps/ \
  --include="*.tsx" --include="*.ts" \
  | grep -v "node_modules\|.next\|oklch"

# Check for arbitrary spacing
grep -rE "\[[0-9]+px\]" apps/ \
  --include="*.tsx" --include="*.ts" \
  | grep -v "node_modules\|.next\|max-w-\[700px\]"

# Check for missing focus states
grep -rE "onClick|onPress|button" apps/ \
  --include="*.tsx" \
  | grep -v "focus:" \
  | grep -v "node_modules"
```

**Automated tool** (coming soon):
```bash
# Future: Full design lint tool
npm run design-lint
```

---

## Summary

**What changed**:
- ❌ Removed: 3-phase design workflow (4,675 lines)
- ✅ Added: Comprehensive style guide SST (1,500 lines)

**Benefits**:
- **75-85% faster** (<30 min vs 2-4 hours)
- **82-88% fewer tokens** (15K vs 85K)
- **Zero manual gates** (automated validation)
- **Single source of truth** (style-guide.md)

**Migration**:
- **Automatic** for new projects
- **One command** for existing projects: `/init-project`
- **No breaking changes**

**Next steps**:
1. Generate style guide: `/init-project`
2. Review and customize: `docs/project/style-guide.md`
3. Try it: `/quick "Add [UI feature]"`
4. Iterate based on feedback

---

**Questions?** See [FAQ](#faq) or check the full documentation in `CLAUDE.md` (v3.0.0 section).

**Feedback?** Report issues at [github.com/anthropics/claude-code/issues](https://github.com/anthropics/claude-code/issues)
